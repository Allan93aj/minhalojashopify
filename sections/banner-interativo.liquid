{{ 'component-banner-interativo.css' | asset_url | stylesheet_tag }}

<section class="main-banner section-{{ section.id }}">
  <ul class="banner-list">
    <div class="banner-items">
      {% for block in section.blocks %}
        <li data-index="{{ forloop.index }}">{{ block.settings.card_title }}</li>
      {% endfor %}
    </div>
    <div class="banner-title">
      <h1>{{ section.settings.banner_title }}</h1>
    </div>
  </ul>

  <div class="cards-container">
    {% for block in section.blocks %}
      <div
        class="cards-expanding"
        data-index="{{ forloop.index }}"
        style="--bg:url('{{ block.settings.background_image | image_url }}')"
      >
        <div class="wrapper-cards-expanding">
          {% if block.settings.overlay_image != blank %}
            <img src="{{ block.settings.overlay_image | image_url }}" alt="{{ block.settings.card_title }}">
          {% endif %}
          <div class="wrapper-number-and-name">
            <p class="card-number">{{ block.settings.card_number }}</p>
            <span class="card-title">{{ block.settings.card_title }}</span>
          </div>
          <div class="content-cards-expanding">
            <div class="inner-content-cards-expanding">
              <div class="btn-cards-expanding">
                <a href="{{ block.settings.button_link }}" class="btn-banner">{{ block.settings.button_text }}</a>
              </div>
              <div class="img-cards-expanding">
                {% if block.settings.inner_image != blank %}
                  <img src="{{ block.settings.inner_image | image_url }}" alt="{{ block.settings.card_title }}">
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</section>



<script>
document.addEventListener("DOMContentLoaded", function() {
  const cards = document.querySelectorAll('.section-{{ section.id }} .cards-expanding');
  const listItems = document.querySelectorAll('.section-{{ section.id }} .banner-list li');
  const bannerTitle = document.querySelector('.section-{{ section.id }} .banner-title');

  cards.forEach((card) => {
    card.addEventListener('mouseenter', () => {
      const index = card.getAttribute('data-index');
      listItems.forEach((li) => {
        li.classList.toggle('active', li.getAttribute('data-index') === index);
      });
      if (bannerTitle) bannerTitle.classList.add('hidden');
    });

    card.addEventListener('mouseleave', () => {
      listItems.forEach((li) => li.classList.remove('active'));
      if (bannerTitle) bannerTitle.classList.remove('hidden');
    });
  });
});



// === Line draw suave e progressivo até 30% da div pai ===
const lineSection = document.querySelector('.line-container');
const paths = lineSection.querySelectorAll('path');

// Inicializa cada path
paths.forEach((path) => {
  const length = path.getTotalLength();
  path.style.strokeDasharray = `${length} ${length}`;
  path.style.strokeDashoffset = length;
  path.style.transition = 'stroke-dashoffset 0.3s ease-out';
});

window.addEventListener('scroll', () => {
  const scrollTop = document.documentElement.scrollTop + document.body.scrollTop;
  const sectionTop = lineSection.offsetTop;
  const sectionHeight = lineSection.offsetHeight;

  // Calcula progresso relativo dentro da seção até 30% da altura
  let scrollRelative = (scrollTop - sectionTop + window.innerHeight) / (sectionHeight * 0.3 + window.innerHeight);
  scrollRelative = Math.min(Math.max(scrollRelative, 0), 1); // limita entre 0 e 1

  const totalPaths = paths.length;
  const sectionSize = 1 / totalPaths;

  paths.forEach((path, i) => {
    const length = path.getTotalLength();
    const start = sectionSize * i;
    const end = sectionSize * (i + 1);

    if (scrollRelative < start) {
      path.style.strokeDashoffset = length;
    } else if (scrollRelative > end) {
      path.style.strokeDashoffset = 0;
    } else {
      const progress = (scrollRelative - start) / sectionSize;
      path.style.strokeDashoffset = length - length * progress;
    }
  });
});
</script>

{% schema %}
{
  "name": "Banner Interativo",
  "tag": "section",
  "class": "section-interactive-banner",
  "settings": [
    {
      "type": "text",
      "id": "banner_title",
      "label": "Título principal do banner",
      "default": "Muito mais do que café. Um lugar de momentos"
    }
  ],
  "blocks": [
    {
      "type": "card",
      "name": "Card Interativo",
      "settings": [
        {
          "type": "text",
          "id": "card_number",
          "label": "Número do card",
          "default": "01"
        },
        {
          "type": "text",
          "id": "card_title",
          "label": "Título do card",
          "default": "Café"
        },
        {
          "type": "image_picker",
          "id": "background_image",
          "label": "Imagem de fundo"
        },
        {
          "type": "image_picker",
          "id": "overlay_image",
          "label": "Imagem de sobreposição (frente do card)"
        },
        {
          "type": "image_picker",
          "id": "inner_image",
          "label": "Imagem interna (ao abrir o card)"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Texto do botão",
          "default": "Ver mais"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Link do botão"
        }
      ]
    }
  ],
  "max_blocks": 7,
  "presets": [
    {
      "name": "Banner Interativo",
      "category": "Banners"
    }
  ]
}
{% endschema %}
