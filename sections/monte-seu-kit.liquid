{{ 'section_monte-seu-kit.css' | asset_url | stylesheet_tag }}
<script src="{{ 'monte-seu-kit.js' | asset_url }}" defer></script>

{% comment %}
Section: Kit Builder Dinâmico
Este componente cria uma montagem de kit com produtos dinâmicos a partir das coleções da loja.
{% endcomment %}

<section class="kit-builder-section">
  <div class="kit-builder-container">
    <h2 class="kit-builder-title">{{ section.settings.title }}</h2>

    <div class="kit-builder-steps">
      {% for i in (1..3) %}
        {% assign select_key = 'select_placeholder_' | append: i %}
        {% assign select_placeholder = section.settings[select_key] %}

        <div class="kit-step" id="kit-step-{{ i }}">
          <h3 class="step-title">Passo {{ i }}: {{ select_placeholder }}</h3>

          <select class="kit-collection-select" data-step="{{ i }}">
            <option value="">Selecione uma coleção</option>
            {% for collection in collections %}
              <option value="{{ collection[1].handle }}">{{ collection[1].title }}</option>
            {% endfor %}
          </select>

          <div class="kit-products-grid" id="products-container-{{ i }}">
            <!-- Aqui os produtos serão carregados via JS após o select -->
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

<style>
.kit-builder-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 40px 20px;
}
.kit-builder-title {
  text-align: center;
  font-size: 2rem;
  margin-bottom: 30px;
}
.kit-step {
  margin-bottom: 40px;
}
.kit-products-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 20px;
}
.kit-product-card {
  border: 1px solid #ddd;
  padding: 15px;
  text-align: center;
  border-radius: 8px;
  transition: 0.3s;
}
.kit-product-card:hover {
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.kit-product-card img {
  width: 100%;
  height: auto;
  margin-bottom: 10px;
}
.select-product-btn {
  background: #000;
  color: #fff;
  border: none;
  padding: 8px 14px;
  border-radius: 5px;
  cursor: pointer;
  transition: 0.3s;
}
.select-product-btn:hover {
  background: #333;
}
.kit-summary {
  text-align: center;
  border-top: 1px solid #ddd;
  padding-top: 30px;
}
#selected-products {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
  margin-bottom: 20px;
}
#selected-products .kit-product-card {
  max-width: 150px;
}
#add-kit-to-cart {
  background: #007b5e;
  color: #fff;
  border: none;
  padding: 12px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}
#add-kit-to-cart:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  document.querySelectorAll('.kit-collection-select').forEach(select => {
    select.addEventListener('change', function() {
      const step = this.dataset.step;
      const handle = this.value;
      const container = document.getElementById(`products-container-${step}`);
      container.innerHTML = '';

      if (!handle) return;

      fetch(`/collections/${handle}/products.json`)
        .then(res => res.json())
        .then(data => {
          data.products.forEach(product => {
            const card = document.createElement('div');
            card.classList.add('kit-product-card');
            card.innerHTML = `
              <img src="${product.images[0]}" alt="${product.title}">
              <h4>${product.title}</h4>
              <p class="kit-product-price">${product.variants[0].price}</p>
              <button class="select-product-btn" data-handle="${product.handle}">Selecionar</button>
            `;
            container.appendChild(card);
          });
        });
    });
  });
});
</script>

{% schema %}
{
  "name": "Kit Builder Dinâmico",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Título da Seção",
      "default": "Monte seu Kit"
    },
    {
      "type": "header",
      "content": "Passo 1"
    },
    {
      "type": "text",
      "id": "select_placeholder_1",
      "label": "Título do Passo 1",
      "default": "Escolha o primeiro produto"
    },
    {
      "type": "collection",
      "id": "collection_1",
      "label": "Coleção - Passo 1"
    },
    {
      "type": "header",
      "content": "Passo 2"
    },
    {
      "type": "text",
      "id": "select_placeholder_2",
      "label": "Título do Passo 2",
      "default": "Escolha o segundo produto"
    },
    {
      "type": "collection",
      "id": "collection_2",
      "label": "Coleção - Passo 2"
    },
    {
      "type": "header",
      "content": "Passo 3"
    },
    {
      "type": "text",
      "id": "select_placeholder_3",
      "label": "Título do Passo 3",
      "default": "Escolha o terceiro produto"
    },
    {
      "type": "collection",
      "id": "collection_3",
      "label": "Coleção - Passo 3"
    }
  ],
  "presets": [
    {
      "name": "Kit Builder Dinâmico",
      "category": "Kits"
    }
  ]
}
{% endschema %}
